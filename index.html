<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Project PI Executive Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
    font-family: Arial, sans-serif;
    background: #f5f7fa;
    margin: 0;
}
.header {
    background: #0b3c5d;
    color: white;
    padding: 14px 24px;
    font-size: 20px;
}
.container {
    padding: 20px;
}
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}
.kpi {
    background: white;
    padding: 15px;
    border-radius: 8px;
    text-align: center;
}
.kpi h3 {
    font-size: 14px;
    margin: 0;
    color: #555;
}
.kpi p {
    font-size: 26px;
    margin: 8px 0 0;
    font-weight: bold;
}
.green { color: #2ecc71; }
.amber { color: #f39c12; }
.red { color: #e74c3c; }

.filters {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}
select {
    padding: 6px;
}

.charts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}
.chart-box {
    background: white;
    padding: 15px;
    border-radius: 8px;
}
canvas {
    height: 280px !important;
}
</style>
</head>

<body>
<div class="header">ðŸ“Š Project PI Executive Dashboard</div>

<div class="container">

<div class="filters">
    <div>
        <label>PI:</label>
        <select id="piFilter"></select>
    </div>
    <div>
        <label>Sprint:</label>
        <select id="sprintFilter"></select>
    </div>
</div>

<div class="kpi-grid">
    <div class="kpi"><h3>PI Predictability</h3><p id="kpiPredictability">--</p></div>
    <div class="kpi"><h3>Planned SP</h3><p id="kpiPlanned">--</p></div>
    <div class="kpi"><h3>Completed SP</h3><p id="kpiCompleted">--</p></div>
    <div class="kpi"><h3>Defect Leakage %</h3><p id="kpiDefect">--</p></div>
    <div class="kpi"><h3>Capacity Utilization %</h3><p id="kpiCapacity">--</p></div>
</div>

<div class="charts">
    <div class="chart-box">
        <h3>PI Velocity Burn-up</h3>
        <canvas id="velocityChart"></canvas>
    </div>
    <div class="chart-box">
        <h3>Predictability Trend</h3>
        <canvas id="predictabilityChart"></canvas>
    </div>
    <div class="chart-box">
        <h3>Defects Raised vs Fixed</h3>
        <canvas id="defectChart"></canvas>
    </div>
    <div class="chart-box">
        <h3>Team Velocity</h3>
        <canvas id="teamVelocityChart"></canvas>
    </div>
</div>

</div>

<script>
let rawData = [];

fetch("SAFe_PI_All_Metrics_Combined.csv")
.then(res => res.text())
.then(csv => {
    const rows = csv.split("\n").map(r => r.split(","));
    const headers = rows.shift();
    rawData = rows.map(r => Object.fromEntries(headers.map((h,i)=>[h,r[i]])));
    initFilters();
    updateDashboard();
});

function initFilters(){
    const piSet = [...new Set(rawData.map(d => d["PI Number"]).filter(Boolean))];
    const sprintSet = [...new Set(rawData.map(d => d["Sprint Number"]).filter(Boolean))];

    piFilter.innerHTML = piSet.map(p => `<option>${p}</option>`).join("");
    sprintFilter.innerHTML = `<option>All</option>` + sprintSet.map(s => `<option>${s}</option>`).join("");

    piFilter.onchange = sprintFilter.onchange = updateDashboard;
}

function updateDashboard(){
    const pi = piFilter.value;
    const sprint = sprintFilter.value;

    const data = rawData.filter(d =>
        d["PI Number"] === pi &&
        (sprint === "All" || d["Sprint Number"] === sprint)
    );

    const sum = (k) => data.reduce((a,b)=>a+(+b[k]||0),0);

    const planned = sum("Total Planned Story Points");
    const completed = sum("Total Completed Story Points");
    const predictability = planned ? ((completed/planned)*100).toFixed(2) : 0;

    document.getElementById("kpiPlanned").innerText = planned;
    document.getElementById("kpiCompleted").innerText = completed;
    document.getElementById("kpiPredictability").innerText = predictability + "%";

    renderVelocity(data);
    renderPredictability(data);
    renderDefects(data);
    renderTeamVelocity(data);
}

function renderVelocity(data){
    const labels = data.map(d => d["Sprint Number"]);
    new Chart(velocityChart, {
        type: "line",
        data: {
            labels,
            datasets: [
                { label:"Planned", data:data.map(d=>+d["Total Planned Story Points"]), borderColor:"#3498db" },
                { label:"Completed", data:data.map(d=>+d["Total Completed Story Points"]), borderColor:"#2ecc71" }
            ]
        }
    });
}

function renderPredictability(data){
    new Chart(predictabilityChart, {
        type:"line",
        data:{
            labels:data.map(d=>d["Sprint Number"]),
            datasets:[{
                label:"Predictability %",
                data:data.map(d=>+d["PI Predictability (%)"]),
                borderColor:"#9b59b6"
            }]
        }
    });
}

function renderDefects(data){
    new Chart(defectChart, {
        type:"bar",
        data:{
            labels:data.map(d=>d["Sprint Number"]),
            datasets:[
                { label:"Raised", data:data.map(d=>+d["Total Defects Raised"]), backgroundColor:"#e74c3c" },
                { label:"Fixed", data:data.map(d=>+d["Total Defects Fixed"]), backgroundColor:"#2ecc71" }
            ]
        }
    });
}

function renderTeamVelocity(data){
    const teamData = data.filter(d=>d["Team Name"]);
    new Chart(teamVelocityChart,{
        type:"bar",
        data:{
            labels:teamData.map(d=>d["Team Name"]),
            datasets:[{
                label:"Velocity",
                data:teamData.map(d=>+d["Velocity"]),
                backgroundColor:"#34495e"
            }]
        }
    });
}
</script>
</body>
</html>
