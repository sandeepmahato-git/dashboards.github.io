<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Agile PI Metrics Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: Segoe UI, Arial, sans-serif;
      background: #f4f6f9;
      margin: 20px;
    }
    h2 {
      margin-bottom: 10px;
    }
    .kpi-container {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 15px;
      margin-bottom: 25px;
    }
    .kpi {
      background: white;
      padding: 15px;
      border-radius: 6px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      text-align: center;
    }
    .kpi h3 {
      margin: 0;
      font-size: 14px;
      color: #666;
    }
    .kpi p {
      font-size: 26px;
      margin: 5px 0 0;
      font-weight: bold;
    }
    .charts {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
    }
    canvas {
      background: white;
      padding: 15px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

<h2>Agile PI Metrics â€“ Summary Dashboard</h2>

<div class="kpi-container">
  <div class="kpi"><h3>Planned SP</h3><p id="plannedSP">-</p></div>
  <div class="kpi"><h3>Completed SP</h3><p id="completedSP">-</p></div>
  <div class="kpi"><h3>Predictability %</h3><p id="predictability">-</p></div>
  <div class="kpi"><h3>Total Defects</h3><p id="defects">-</p></div>
  <div class="kpi"><h3>Budget Used %</h3><p id="budget">-</p></div>
</div>

<div class="charts">
  <canvas id="spChart"></canvas>
  <canvas id="velocityChart"></canvas>
  <canvas id="defectChart"></canvas>
</div>

<script>
fetch("data.json")
  .then(response => response.json())
  .then(data => {

    /* ---- ASSUMPTION ----
       Adjust sheet names & column names
       based on your actual JSON structure
    ---------------------*/

    const delivery = data["Delivery"] || data[Object.keys(data)[0]];
    
    let teams = [];
    let plannedSP = [];
    let completedSP = [];

    let totalPlanned = 0;
    let totalCompleted = 0;

    delivery.forEach(row => {
      teams.push(row.Team);
      plannedSP.push(row.Planned_SP);
      completedSP.push(row.Completed_SP);
      totalPlanned += row.Planned_SP;
      totalCompleted += row.Completed_SP;
    });

    const predictability = ((totalCompleted / totalPlanned) * 100).toFixed(1);

    document.getElementById("plannedSP").innerText = totalPlanned;
    document.getElementById("completedSP").innerText = totalCompleted;
    document.getElementById("predictability").innerText = predictability + "%";

    // Dummy values if separate sheets exist
    document.getElementById("defects").innerText = 42;
    document.getElementById("budget").innerText = "92%";

    /* ---- Planned vs Completed SP ---- */
    new Chart(document.getElementById("spChart"), {
      type: "bar",
      data: {
        labels: teams,
        datasets: [
          { label: "Planned SP", data: plannedSP },
          { label: "Completed SP", data: completedSP }
        ]
      },
      options: {
        responsive: true,
        plugins: { title: { display: true, text: "Planned vs Completed Story Points" } }
      }
    });

    /* ---- Velocity Trend ---- */
    new Chart(document.getElementById("velocityChart"), {
      type: "line",
      data: {
        labels: teams,
        datasets: [{
          label: "Completed SP",
          data: completedSP,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: { title: { display: true, text: "Delivery / Velocity Trend" } }
      }
    });

    /* ---- Defect Summary ---- */
    new Chart(document.getElementById("defectChart"), {
      type: "bar",
      data: {
        labels: ["New", "Closed", "Escaped"],
        datasets: [{
          label: "Defects",
          data: [20, 15, 7]
        }]
      },
      options: {
        responsive: true,
        plugins: { title: { display: true, text: "Defect Summary" } }
      }
    });

  });
</script>

</body>
</html>
