<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Project PI Executive Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f9;
    margin: 0;
}
.header {
    background: #0b3c5d;
    color: white;
    padding: 16px 24px;
    font-size: 20px;
}
.container {
    padding: 20px;
}
.filters {
    display: flex;
    gap: 20px;
    margin-bottom: 20px;
}
select {
    padding: 6px;
}
.kpi-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
    margin-bottom: 20px;
}
.kpi {
    background: white;
    padding: 16px;
    border-radius: 8px;
    text-align: center;
}
.kpi h3 {
    margin: 0;
    font-size: 14px;
    color: #555;
}
.kpi p {
    font-size: 26px;
    margin: 8px 0 0;
    font-weight: bold;
}
.green { color: #2ecc71; }
.amber { color: #f39c12; }
.red { color: #e74c3c; }

.charts {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
}
.chart-box {
    background: white;
    padding: 16px;
    border-radius: 8px;
}
canvas {
    height: 280px !important;
}
</style>
</head>

<body>

<div class="header">ðŸ“Š Project PI Executive Dashboard</div>

<div class="container">

<!-- Filters -->
<div class="filters">
    <div>
        <label>PI Number</label><br>
        <select id="piFilter"></select>
    </div>
    <div>
        <label>Sprint</label><br>
        <select id="sprintFilter"></select>
    </div>
</div>

<!-- KPI Section -->
<div class="kpi-grid">
    <div class="kpi">
        <h3>PI Predictability</h3>
        <p id="kpiPredictability">--%</p>
    </div>
    <div class="kpi">
        <h3>Planned Story Points</h3>
        <p id="kpiPlanned">--</p>
    </div>
    <div class="kpi">
        <h3>Completed Story Points</h3>
        <p id="kpiCompleted">--</p>
    </div>
    <div class="kpi">
        <h3>Defect Fix Rate</h3>
        <p id="kpiDefects">--%</p>
    </div>
</div>

<!-- Charts -->
<div class="charts">
    <div class="chart-box">
        <h3>PI Velocity Burn-up</h3>
        <canvas id="velocityChart"></canvas>
    </div>
    <div class="chart-box">
        <h3>Predictability Trend</h3>
        <canvas id="predictabilityChart"></canvas>
    </div>
    <div class="chart-box">
        <h3>Defects Raised vs Fixed</h3>
        <canvas id="defectChart"></canvas>
    </div>
    <div class="chart-box">
        <h3>Team Velocity</h3>
        <canvas id="teamChart"></canvas>
    </div>
</div>

</div>

<script>
let rawData = [];
let charts = [];

fetch("csvjson.json")
.then(res => res.json())
.then(data => {
    rawData = data;
    initFilters();
    updateDashboard();
});

function initFilters() {
    const pis = [...new Set(rawData.map(d => d["PI Number"]).filter(Boolean))];
    const sprints = [...new Set(rawData.map(d => d["Sprint Number"]).filter(Boolean))];

    piFilter.innerHTML = pis.map(p => `<option>${p}</option>`).join("");
    sprintFilter.innerHTML = `<option>All</option>` +
        sprints.map(s => `<option>${s}</option>`).join("");

    piFilter.onchange = sprintFilter.onchange = updateDashboard;
}

function updateDashboard() {
    charts.forEach(c => c.destroy());
    charts = [];

    const pi = piFilter.value;
    const sprint = sprintFilter.value;

    const data = rawData.filter(d =>
        d["PI Number"] === pi &&
        (sprint === "All" || d["Sprint Number"] === sprint)
    );

    const sprintData = data.filter(d => d["Source_Sheet"] === "PI_Sprint_Summary");
    const teamData = data.filter(d => d["Source_Sheet"] === "Team_Velocity_Capacity");

    const sum = (arr, key) => arr.reduce((a,b)=>a+(+b[key]||0),0);

    const planned = sum(sprintData, "Total Planned Story Points");
    const completed = sum(sprintData, "Total Completed Story Points");
    const defectsRaised = sum(sprintData, "Total Defects Raised");
    const defectsFixed = sum(sprintData, "Total Defects Fixed");

    const predictability = planned ? ((completed/planned)*100).toFixed(2) : 0;
    const defectFixRate = defectsRaised ? ((defectsFixed/defectsRaised)*100).toFixed(1) : 0;

    document.getElementById("kpiPlanned").innerText = planned;
    document.getElementById("kpiCompleted").innerText = completed;
    document.getElementById("kpiPredictability").innerText = predictability + "%";
    document.getElementById("kpiDefects").innerText = defectFixRate + "%";

    renderVelocity(sprintData);
    renderPredictability(sprintData);
    renderDefects(sprintData);
    renderTeamVelocity(teamData);
}

function renderVelocity(data){
    charts.push(new Chart(velocityChart,{
        type:"line",
        data:{
            labels:data.map(d=>d["Sprint Number"]),
            datasets:[
                {label:"Planned", data:data.map(d=>+d["Total Planned Story Points"]), borderColor:"#3498db"},
                {label:"Completed", data:data.map(d=>+d["Total Completed Story Points"]), borderColor:"#2ecc71"}
            ]
        }
    }));
}

function renderPredictability(data){
    charts.push(new Chart(predictabilityChart,{
        type:"line",
        data:{
            labels:data.map(d=>d["Sprint Number"]),
            datasets:[{
                label:"Predictability %",
                data:data.map(d=>+d["PI Predictability (%)"]),
                borderColor:"#9b59b6"
            }]
        }
    }));
}

function renderDefects(data){
    charts.push(new Chart(defectChart,{
        type:"bar",
        data:{
            labels:data.map(d=>d["Sprint Number"]),
            datasets:[
                {label:"Raised", data:data.map(d=>+d["Total Defects Raised"]), backgroundColor:"#e74c3c"},
                {label:"Fixed", data:data.map(d=>+d["Total Defects Fixed"]), backgroundColor:"#2ecc71"}
            ]
        }
    }));
}

function renderTeamVelocity(data){
    charts.push(new Chart(teamChart,{
        type:"bar",
        data:{
            labels:data.map(d=>d["Team Name"]),
            datasets:[{
                label:"Velocity",
                data:data.map(d=>+d["Velocity"]),
                backgroundColor:"#34495e"
            }]
        }
    }));
}
</script>

</body>
</html>
